<!-- TODO these are mocks! remove me after integration -->
<policies>
    <inbound>
        <base/>
        <set-variable name="institutionId" value="@(context.Request.Url.Query.GetValueOrDefault("institutionId",""))" />
        <choose>
            <when condition="@(((string)context.Variables["institutionId"]).Equals("infoError"))">
                <return-response>
                    <set-status code="400" reason="Invalid ID supplied"/>
                    <set-header name="Content-Type" exists-action="override">
                        <value>application/json</value>
                    </set-header>
                    <set-body>
                        {
                        "detail": "Request took too long to complete.",
                        "status": 503,
                        "title": "Service Unavailable"
                        }
                    </set-body>
                </return-response>
            </when>
            <when condition="@(((string)context.Variables["institutionId"]).Equals("onboarded"))">
                <return-response>
                    <set-status code="200" reason="OK"/>
                    <set-header name="Content-Type" exists-action="override">
                        <value>application/json</value>
                    </set-header>
                    <set-body>
                        {
                        "person": {
                        "name": "name",
                        "surname": "surname",
                        "taxCode": "AAAAAA00A00A000A"
                        },
                        "institutions": [
                        {
                        "institutionId": "onboarded",
                        "description": "AGENCY ONBOARDED",
                        "digitalAddress": "digitalAddress",
                        "state": "ACTIVE",
                        "role": "MANAGER",
                        "platformRole": "ADMIN",
                        "productRole": "ADMIN",
                        "attributes": [
                        "string"
                        ]
                        }
                        ]
                        }
                    </set-body>
                </return-response>
            </when>
            <when condition="@(((string)context.Variables["institutionId"]).Equals("pending"))">
                <return-response>
                    <set-status code="200" reason="OK"/>
                    <set-header name="Content-Type" exists-action="override">
                        <value>application/json</value>
                    </set-header>
                    <set-body>
                        {
                        "person": {
                        "name": "name",
                        "surname": "surname",
                        "taxCode": "AAAAAA00A00A000A"
                        },
                        "institutions": [
                        {
                        "institutionId": "pending",
                        "description": "AGENCY PENDING",
                        "digitalAddress": "digitalAddress",
                        "state": "PENDING",
                        "role": "MANAGER",
                        "platformRole": "TECH_REF",
                        "productRole": "TECH_REF",
                        "attributes": [
                        "string"
                        ]
                        }
                        ]
                        }
                    </set-body>
                </return-response>
            </when>
            <when condition="@(((string)context.Variables["institutionId"]).Equals("id"))">
                <return-response>
                    <set-status code="200" reason="OK"/>
                    <set-header name="Content-Type" exists-action="override">
                        <value>application/json</value>
                    </set-header>
                    <set-body>
                        {
                        "person": {
                        "name": "name",
                        "surname": "surname",
                        "taxCode": "AAAAAA00A00A000A"
                        },
                        "institutions": []
                        }
                    </set-body>
                </return-response>
            </when>
            <otherwise>
                <return-response>
                    <set-status code="200" reason="OK"/>
                    <set-header name="Content-Type" exists-action="override">
                        <value>application/json</value>
                    </set-header>
                    <set-body>
                        {
                            "person": {
                                "name": "name",
                                "surname": "surname",
                                "taxCode": "AAAAAA00A00A000A"
                            },
                            "institutions": [
                                {
                                "role": "MANAGER",
                                "description": "Comune di Bari",
                                "state": "PENDING",
                                "institutionId": "1",
                                "attributes": [],
                                "digitalAddress": "",
                                "platformRole": "ADMIN_REF",
                                "productRole": "ADMIN_REF"
                                },
                                {
                                "role": "MANAGER",
                                "description": "Comune di Milano",
                                "state": "PENDING",
                                "institutionId": "2",
                                "attributes": [],
                                "digitalAddress": "",
                                "platformRole": "TECH_REF",
                                "productRole": "TECH_REF"
                                },
                                {
                                "role": "MANAGER",
                                "description": "Comune di Roma",
                                "state": "ACTIVE",
                                "institutionId": "3",
                                "attributes": [],
                                "digitalAddress": "",
                                "platformRole": "ADMIN_REF",
                                "productRole": "ADMIN_REF"
                                },
                                {
                                "role": "MANAGER",
                                "description": "Comune di Napoli",
                                "state": "ACTIVE",
                                "institutionId": "4",
                                "attributes": [],
                                "digitalAddress": "",
                                "platformRole": "TECH_REF",
                                "productRole": "TECH_REF"
                                },
                                {
                                "institutionId": "onboarded",
                                "description": "AGENCY ONBOARDED",
                                "digitalAddress": "digitalAddress",
                                "state": "ACTIVE",
                                "role": "MANAGER",
                                "platformRole": "ADMIN",
                                "productRole": "ADMIN",
                                "attributes": [
                                "string"
                                ]
                                }
                            ]
                        }
                    </set-body>
                </return-response>
            </otherwise>
        </choose>
    </inbound>
    <backend>
        <base/>
    </backend>
    <outbound>
        <base/>
    </outbound>
    <on-error>
        <base/>
    </on-error>
</policies>
